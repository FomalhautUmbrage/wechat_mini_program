<t-navbar title="排行榜" left-arrow />
<view class="rankings-page">
  <!-- Top dropdown selector -->
  <view class="dropdown-container">
    <view class="ranking-dropdown" bind:tap="toggleDropdown">
      <text>{{rankingType}}</text>
      <t-icon name="caret-down-small" size="48rpx" />
    </view>
    
    <!-- 显示当前Excel文件名称 -->
    <view class="excel-info" wx:if="{{excelFileName}}">
      <t-icon name="file-excel" size="32rpx" />
      <text>{{excelFileName}}</text>
    </view>
    
    <t-popup visible="{{visible}}" bind:visible-change="onVisibleChange" placement="top">
      <view class="popup-content">
        <view 
          class="popup-item {{item.label === rankingType ? 'active' : ''}}" 
          wx:for="{{rankingOptions}}" 
          wx:key="value" 
          data-value="{{item.value}}"
          data-label="{{item.label}}"
          bind:tap="handleOptionChange"
        >
          {{item.label}}
        </view>
      </view>
    </t-popup>
  </view>

  <!-- 无数据状态提示 -->
  <view class="no-data-container" wx:if="{{!hasData && !loading}}">
    <t-empty icon="info-circle-filled" description="暂无排行榜数据" />
    <view class="no-data-tips">可以在"我的"页面上传排行榜数据</view>
  </view>

  <!-- Loading indicator -->
  <view class="loading-container" wx:if="{{loading}}">
    <t-loading theme="circular" size="48rpx" />
    <text class="loading-text">数据加载中...</text>
  </view>

  <!-- Top 3 podium visualization with animation class -->
  <view class="podium-container {{animationClass}}" wx:if="{{hasData && !loading}}">
    <!-- Second place - left -->
    <view class="podium-item second">
      <view class="rank-avatar">
        <t-avatar wx:if="{{rankings.length > 1}}" image="{{rankings[1].avatar}}" size="large"></t-avatar>
      </view>
      <view class="podium-block">
        <view class="podium-number">2</view>
        <view class="podium-name" wx:if="{{rankings.length > 1}}">{{rankings[1].name}}</view>
        <view class="podium-value" wx:if="{{rankings.length > 1}}">{{rankings[1].value}}</view>
      </view>
    </view>

    <!-- First place - middle (taller) -->
    <view class="podium-item first">
      <view class="rank-avatar">
        <t-avatar wx:if="{{rankings.length > 0}}" image="{{rankings[0].avatar}}" size="large"></t-avatar>
      </view>
      <view class="podium-block">
        <view class="podium-number">1</view>
        <view class="podium-name" wx:if="{{rankings.length > 0}}">{{rankings[0].name}}</view>
        <view class="podium-value" wx:if="{{rankings.length > 0}}">{{rankings[0].value}}</view>
      </view>
    </view>

    <!-- Third place - right -->
    <view class="podium-item third">
      <view class="rank-avatar">
        <t-avatar wx:if="{{rankings.length > 2}}" image="{{rankings[2].avatar}}" size="large"></t-avatar>
      </view>
      <view class="podium-block">
        <view class="podium-number">3</view>
        <view class="podium-name" wx:if="{{rankings.length > 2}}">{{rankings[2].name}}</view>
        <view class="podium-value" wx:if="{{rankings.length > 2}}">{{rankings[2].value}}</view>
      </view>
    </view>
  </view>

  <!-- Remaining rankings list with animation class -->
  <view class="rankings-list {{animationClass}}" wx:if="{{hasData && !loading}}">
    <t-cell-group>
      <t-cell
        wx:for="{{rankings}}"
        wx:key="index"
        wx:if="{{index > 2}}"
        hover
        bordered="{{index !== rankings.length - 1}}"
      >
        <view slot="left-icon" class="rank-number">{{index + 1}}</view>
        <view slot="title" class="rank-name">{{item.name}}</view>
        <view slot="description" class="rank-value">{{rankingType}}: {{item.value}}</view>
        <t-avatar slot="right-icon" image="{{item.avatar}}" size="small"></t-avatar>
      </t-cell>
    </t-cell-group>
  </view>
</view>

<t-toast id="t-toast" />