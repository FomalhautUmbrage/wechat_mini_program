<t-navbar title="积分中心" left-arrow />

<view class="points-container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <t-loading theme="circular" size="48rpx" />
    <text class="loading-text">数据加载中...</text>
  </view>
  
  <!-- 无数据状态 -->
  <view wx:elif="{{noData}}" class="no-data-container">
    <t-empty icon="info-circle-filled" description="暂无积分数据" />
    <view class="no-data-tip">请在"我的"页面上传排行榜数据或记录武道会</view>
  </view>
  
  <!-- 有数据状态 -->
  <block wx:else>
    <!-- 筛选条件区域 -->
    <view class="filter-container">
      <!-- 排序方式 -->
      <view class="filter-section">
        <view class="filter-title">排序方式</view>
        <view class="filter-options">
          <view 
            class="filter-option {{sortType === 'points' ? 'active' : ''}}" 
            bindtap="changeSortType" 
            data-type="points"
          >积分</view>
          <view 
            class="filter-option {{sortType === 'championships' ? 'active' : ''}}" 
            bindtap="changeSortType" 
            data-type="championships"
          >冠军数</view>
          <view 
            class="filter-option {{sortType === 'wins' ? 'active' : ''}}" 
            bindtap="changeSortType" 
            data-type="wins"
          >胜场数</view>
          <view 
            class="filter-option {{sortType === 'laoBa' ? 'active' : ''}}" 
            bindtap="changeSortType" 
            data-type="laoBa"
          >老八数</view>
        </view>
      </view>
      
      <!-- 时间范围 -->
      <view class="filter-section">
        <view class="filter-title">时间范围</view>
        <view class="filter-options">
          <view 
            class="filter-option {{timeRange === 'all' ? 'active' : ''}}" 
            bindtap="changeTimeRange" 
            data-range="all"
          >全部</view>
          <view 
            class="filter-option {{timeRange === 'month' ? 'active' : ''}}" 
            bindtap="changeTimeRange" 
            data-range="month"
          >上个月</view>
          <view 
            class="filter-option {{timeRange === 'threeMonths' ? 'active' : ''}}" 
            bindtap="changeTimeRange" 
            data-range="threeMonths"
          >近三个月</view>
        </view>
      </view>
    </view>
    
    <!-- 前三名展示 -->
    <view class="top-players" wx:if="{{filteredData.length >= 3}}">
      <!-- 第二名 -->
      <view class="top-player second">
        <view class="rank-badge rank-2">2</view>
        <view class="player-name">{{filteredData[1].name}}</view>
        <view class="player-points">{{filteredData[1].points}} 分</view>
      </view>
      
      <!-- 第一名 -->
      <view class="top-player first">
        <view class="crown-icon"></view>
        <view class="rank-badge rank-1">1</view>
        <view class="player-name">{{filteredData[0].name}}</view>
        <view class="player-points">{{filteredData[0].points}} 分</view>
      </view>
      
      <!-- 第三名 -->
      <view class="top-player third">
        <view class="rank-badge rank-3">3</view>
        <view class="player-name">{{filteredData[2].name}}</view>
        <view class="player-points">{{filteredData[2].points}} 分</view>
      </view>
    </view>
    
    <!-- 积分排行榜 -->
    <view class="points-ranking">
      <view class="section-title">积分排行榜</view>
      
      <view class="ranking-list">
        <view 
          wx:for="{{filteredData}}" 
          wx:key="id" 
          class="ranking-item {{getRankClass(index)}}"
        >
          <view class="ranking-rank">{{index + 1}}</view>
          <view class="ranking-info">
            <view class="ranking-name">{{item.name}}</view>
            <view class="ranking-stats">
              <text class="stats-item">积分: {{item.points}}</text>
              <text class="stats-item">冠军: {{item.championships}}</text>
              <text class="stats-item">胜场: {{item.wins}}</text>
              <text class="stats-item">老八: {{item.laoBa}}</text>
            </view>
          </view>
          <view class="ranking-points">
            <text class="points-value">{{item.points}}</text>
            <text class="points-label">分</text>
          </view>
        </view>
      </view>
    </view>
  </block>
</view>

<t-toast id="t-toast" />